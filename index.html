<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sport Itapu칤 - Agendamento de T칡nis</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    .slot-booked { background-color: #ef4444; color: white; }
    .slot-available { background-color: #10b981; color: white; }
    .slot-my-booking { background-color: #3b82f6; color: white; }
  </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 min-h-screen">
  <!-- (mantive toda a estrutura de login, dashboards e modais exatamente igual ao seu arquivo) -->

  <!-- ... [HTML DAS TELAS MANTIDO IGUAL AO SEU ARQUIVO ORIGINAL] ... -->

  <script>
    // 游댳 Configura칞칚o Supabase
    const supabaseUrl = "https://ycaeeghhwiieuaugivey.supabase.co"; // substitua
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InljYWVlZ2hod2lpZXVhdWdpdmV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwNzY0NjYsImV4cCI6MjA3MzY1MjQ2Nn0.OAAOVPTG-IJSy16FSVipG6qtNCu7T15qpiP361TFxFY; // substitua"
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    // Vari치veis globais
    let currentUser = null;
    let isAdmin = false;
    let currentWeekStart = null;
    let activeWeekStart = null;
    let bookings = {};
    let blockedSlots = {};
    let isBlockMode = false;
    let selectedSlot = null;
    let selectedDay = 0;
    let selectedAdminDay = 0;

    // 游댳 Inicializa칞칚o
    async function initSystem() {
      const today = new Date();
      const dayOfWeek = today.getDay();
      const daysToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
      currentWeekStart = new Date(today);
      currentWeekStart.setDate(today.getDate() + daysToMonday);
      currentWeekStart.setHours(0, 0, 0, 0);

      if (!activeWeekStart) activeWeekStart = new Date(currentWeekStart);

      await loadBookings();
      await loadBlocks();
    }

    // 游댳 Login S칩cio
    async function memberLogin(event) {
      event.preventDefault();
      const name = document.getElementById("memberName").value.trim();
      const cpfInput = document.getElementById("memberCPF");
      const cpf = cpfInput.value.trim();

      if (!validateCPF(cpfInput)) {
        alert("Por favor, digite um CPF v치lido!");
        return;
      }

      let { data: member } = await supabase
        .from("members")
        .select("*")
        .eq("cpf", cpf)
        .single();

      if (!member) {
        let { data, error } = await supabase
          .from("members")
          .insert([{ name, cpf }])
          .select()
          .single();
        if (error) {
          alert("Erro ao registrar s칩cio: " + error.message);
          return;
        }
        member = data;
      }

      currentUser = member;
      isAdmin = false;
      currentWeekStart = new Date(activeWeekStart);
      document.getElementById("currentMemberName").textContent = name;
      document.getElementById("memberLogin").classList.add("hidden");
      document.getElementById("memberDashboard").classList.remove("hidden");
      await loadBookings();
      updateScheduleDisplay();
    }

    // 游댳 Login Admin
    function adminLogin(event) {
      event.preventDefault();
      const user = document.getElementById("adminUser").value;
      const pass = document.getElementById("adminPass").value;
      if (user === "Admin" && pass === "Admin") {
        currentUser = { name: "Administrador" };
        isAdmin = true;
        document.getElementById("adminLogin").classList.add("hidden");
        document.getElementById("adminDashboard").classList.remove("hidden");
        updateAdminScheduleDisplay();
      } else {
        alert("Usu치rio ou senha incorretos!");
      }
    }

    // 游댳 Carregar Agendamentos
    async function loadBookings() {
      const { data } = await supabase
        .from("bookings")
        .select("*, members(name, cpf)")
        .eq("week_start", getWeekKey());

      bookings = {};
      if (data) {
        data.forEach((b) => {
          const slotKey = `${b.week_start}-${b.day_index}-${b.hour}`;
          bookings[slotKey] = {
            userName: b.members.name,
            userCPF: b.members.cpf,
          };
        });
      }
    }

    // 游댳 Carregar Bloqueios
    async function loadBlocks() {
      const { data } = await supabase.from("blocked_slots").select("*");
      blockedSlots = {};
      if (data) {
        data.forEach((block) => {
          blockedSlots[`${block.day_index}-${block.hour}`] = block;
        });
      }
    }

    // 游댳 Confirmar Agendamento
    async function confirmBooking() {
      if (selectedSlot) {
        const { error } = await supabase.from("bookings").insert([
          {
            member_id: currentUser.id,
            week_start: getWeekKey(),
            day_index: selectedSlot.dayIndex,
            hour: selectedSlot.hour,
          },
        ]);
        if (error) {
          alert("Erro ao agendar: " + error.message);
          return;
        }
        await loadBookings();
        updateScheduleDisplay();
        closeBookingModal();
        alert("Agendamento realizado com sucesso!");
      }
    }

    // 游댳 Cancelar Agendamento
    async function confirmCancel() {
      if (selectedSlot) {
        const slotKey = `${getWeekKey()}-${selectedSlot.dayIndex}-${selectedSlot.hour}`;
        const booking = bookings[slotKey];
        if (!booking) return;

        const { error } = await supabase
          .from("bookings")
          .delete()
          .eq("week_start", getWeekKey())
          .eq("day_index", selectedSlot.dayIndex)
          .eq("hour", selectedSlot.hour)
          .eq("member_id", currentUser.id);

        if (error) {
          alert("Erro ao cancelar: " + error.message);
          return;
        }
        await loadBookings();
        updateScheduleDisplay();
        closeCancelModal();
        alert("Agendamento cancelado!");
      }
    }

    // 游댳 Bloqueio de hor치rios
    async function toggleBlockSlot(dayIndex, hour) {
      const blockKey = `${dayIndex}-${hour}`;
      if (blockedSlots[blockKey]) {
        await supabase.from("blocked_slots").delete().eq("id", blockedSlots[blockKey].id);
      } else {
        await supabase.from("blocked_slots").insert([{ day_index: dayIndex, hour }]);
      }
      await loadBlocks();
      updateAdminScheduleDisplay();
    }

    async function removeBlock(blockKey) {
      const block = blockedSlots[blockKey];
      if (!block) return;
      await supabase.from("blocked_slots").delete().eq("id", block.id);
      await loadBlocks();
      updateBlocksList();
      updateAdminScheduleDisplay();
    }

    // 游댳 Utilit치rios
    function getWeekKey() {
      return currentWeekStart.toISOString().split("T")[0];
    }
    function formatWeekDisplay(weekStart) {
      const weekEnd = new Date(weekStart);
      weekEnd.setDate(weekStart.getDate() + 6);
      const options = { day: "2-digit", month: "2-digit", year: "numeric" };
      return `${weekStart.toLocaleDateString("pt-BR", options)} a ${weekEnd.toLocaleDateString("pt-BR", options)}`;
    }

    // Iniciar sistema
    initSystem();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Agendamento - Clube de Tênis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .time-slot {
            transition: all 0.2s ease;
        }
        .time-slot:hover {
            transform: translateY(-1px);
        }
        .booked {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        .available {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .my-booking {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        .tooltip {
            position: relative;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <img src="https://i.postimg.cc/9FG4YkXP/logo.jpg" alt="Logo do Clube" class="h-12 w-auto" onerror="this.src=''; this.alt='Logo não disponível'; this.style.display='none';">
                <h1 class="text-2xl font-bold text-gray-800">Sistema de Agendamento</h1>
            </div>
            <div id="userInfo" class="hidden">
                <span id="userName" class="text-gray-600 mr-4"></span>
                <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                    Sair
                </button>
            </div>
        </div>
    </header>

    <!-- Login/Register Form -->
    <div id="authContainer" class="max-w-md mx-auto mt-8 bg-white rounded-xl shadow-lg p-6">
        <div class="flex mb-6">
            <button id="loginTab" onclick="showLogin()" class="flex-1 py-2 px-4 bg-green-500 text-white rounded-l-lg">
                Login
            </button>
            <button id="registerTab" onclick="showRegister()" class="flex-1 py-2 px-4 bg-gray-300 text-gray-700 rounded-r-lg">
                Cadastro
            </button>
        </div>

        <!-- Login Form -->
        <form id="loginForm" onsubmit="login(event)">
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2">Email</label>
                <input type="email" id="loginEmail" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-green-500">
            </div>
            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-bold mb-2">Senha</label>
                <input type="password" id="loginPassword" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-green-500">
            </div>
            <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                Entrar
            </button>
        </form>

        <!-- Register Form -->
        <form id="registerForm" class="hidden" onsubmit="register(event)">
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2">Nome</label>
                <input type="text" id="registerName" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-green-500">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2">Email</label>
                <input type="email" id="registerEmail" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-green-500">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2">Telefone</label>
                <input type="tel" id="registerPhone" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-green-500">
            </div>
            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-bold mb-2">Senha</label>
                <input type="password" id="registerPassword" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-green-500">
            </div>
            <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                Cadastrar
            </button>
        </form>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden max-w-7xl mx-auto px-4 py-8">
        <!-- Date Navigation -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex items-center justify-between mb-4">
                <button onclick="changeWeek(-1)" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                    ← Semana Anterior
                </button>
                <div class="text-center">
                    <h2 id="weekDisplay" class="text-xl font-bold text-gray-800">Semana Atual</h2>
                    <p class="text-sm text-gray-600 mt-1" id="weekStatus">Agendamentos disponíveis apenas para esta semana</p>
                </div>
                <button onclick="changeWeek(1)" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                    Semana Seguinte →
                </button>
            </div>
            <div id="dateButtons" class="grid grid-cols-7 gap-2"></div>
        </div>

        <!-- Schedule Grid -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Horários Disponíveis - <span id="selectedDateDisplay"></span></h3>
            <div id="scheduleGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"></div>
        </div>

        <!-- My Bookings -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-gray-800">Meus Agendamentos</h3>
                <button id="exportButton" onclick="exportToCSV()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2 hidden">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <span>Exportar CSV</span>
                </button>
            </div>
            <div id="myBookings" class="space-y-3"></div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('tennisUsers') || '[]');
        let bookings = JSON.parse(localStorage.getItem('tennisBookings') || '[]');
        let currentWeekStart = new Date();
        let selectedDate = new Date();

        // Set current week to Monday - usando 12/09/2024 como referência
        currentWeekStart = new Date('2024-09-12');
        currentWeekStart.setDate(currentWeekStart.getDate() - currentWeekStart.getDay() + 1);
        selectedDate = new Date(currentWeekStart);

        // Auth functions
        function showLogin() {
            document.getElementById('loginTab').className = 'flex-1 py-2 px-4 bg-green-500 text-white rounded-l-lg';
            document.getElementById('registerTab').className = 'flex-1 py-2 px-4 bg-gray-300 text-gray-700 rounded-r-lg';
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('loginTab').className = 'flex-1 py-2 px-4 bg-gray-300 text-gray-700 rounded-l-lg';
            document.getElementById('registerTab').className = 'flex-1 py-2 px-4 bg-green-500 text-white rounded-r-lg';
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        function register(event) {
            event.preventDefault();
            console.log('Tentando cadastrar...');
            
            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const phone = document.getElementById('registerPhone').value.trim();
            const password = document.getElementById('registerPassword').value.trim();

            console.log('Dados:', { name, email, phone, password });

            if (!name || !email || !phone || !password) {
                alert('Por favor, preencha todos os campos!');
                return;
            }

            // Recarregar usuários do localStorage
            users = JSON.parse(localStorage.getItem('tennisUsers') || '[]');
            
            if (users.find(u => u.email === email)) {
                alert('Email já cadastrado!');
                return;
            }

            const newUser = { id: Date.now(), name, email, phone, password };
            users.push(newUser);
            localStorage.setItem('tennisUsers', JSON.stringify(users));
            
            console.log('Usuário cadastrado:', newUser);
            console.log('Total de usuários:', users.length);
            
            alert('Cadastro realizado com sucesso!');
            document.getElementById('registerForm').reset();
            showLogin();
        }

        function login(event) {
            event.preventDefault();
            console.log('Tentando fazer login...');
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value.trim();

            console.log('Dados de login:', { email, password });

            if (!email || !password) {
                alert('Por favor, preencha email e senha!');
                return;
            }

            // Verificar se é o administrador
            if (email === 'Admin' && password === 'R@@t') {
                currentUser = { 
                    id: 'admin', 
                    name: 'Administrador', 
                    email: 'Admin', 
                    isAdmin: true 
                };
                localStorage.setItem('currentTennisUser', JSON.stringify(currentUser));
                document.getElementById('userName').textContent = currentUser.name + ' (Admin)';
                document.getElementById('authContainer').classList.add('hidden');
                document.getElementById('userInfo').classList.remove('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                
                console.log('Login de administrador realizado com sucesso!');
                initializeApp();
                return;
            }

            // Recarregar usuários do localStorage
            users = JSON.parse(localStorage.getItem('tennisUsers') || '[]');
            console.log('Usuários disponíveis:', users);

            const user = users.find(u => u.email === email && u.password === password);
            console.log('Usuário encontrado:', user);
            
            if (!user) {
                alert('Email ou senha incorretos!');
                return;
            }

            currentUser = user;
            localStorage.setItem('currentTennisUser', JSON.stringify(user));
            document.getElementById('userName').textContent = user.name;
            document.getElementById('authContainer').classList.add('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            console.log('Login realizado com sucesso!');
            initializeApp();
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentTennisUser');
            document.getElementById('authContainer').classList.remove('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginForm').reset();
            document.getElementById('registerForm').reset();
        }

        // App functions
        function initializeApp() {
            updateWeekDisplay();
            updateDateButtons();
            updateScheduleGrid();
            updateMyBookings();
            
            // Mostrar botão de exportar CSV apenas para administrador
            const exportButton = document.getElementById('exportButton');
            if (currentUser && currentUser.isAdmin) {
                exportButton.classList.remove('hidden');
            } else {
                exportButton.classList.add('hidden');
            }
        }

        function changeWeek(direction) {
            const newWeekStart = new Date(currentWeekStart);
            newWeekStart.setDate(newWeekStart.getDate() + (direction * 7));
            
            // Get current week start (Monday) - usando 12/09/2024 como referência
            const today = new Date('2024-09-12');
            const currentWeekMonday = new Date(today);
            currentWeekMonday.setDate(today.getDate() - today.getDay() + 1);
            
            // Permitir navegação para frente sempre, mas não para trás da semana atual
            if (direction > 0 || newWeekStart.getTime() >= currentWeekMonday.getTime()) {
                currentWeekStart = newWeekStart;
                selectedDate = new Date(currentWeekStart); // Sempre começar na segunda-feira
                updateWeekDisplay();
                updateDateButtons();
                updateScheduleGrid();
            } else {
                alert('Não é possível navegar para semanas anteriores à atual.');
            }
        }

        function updateWeekDisplay() {
            const endDate = new Date(currentWeekStart);
            endDate.setDate(endDate.getDate() + 6);
            
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            const startStr = currentWeekStart.toLocaleDateString('pt-BR', options);
            const endStr = endDate.toLocaleDateString('pt-BR', options);
            
            // Verificar se é a semana atual - usando 12/09/2024 como referência
            const today = new Date('2024-09-12');
            const currentWeekMonday = new Date(today);
            currentWeekMonday.setDate(today.getDate() - today.getDay() + 1);
            
            const isCurrentWeek = currentWeekStart.getTime() === currentWeekMonday.getTime();
            const isFutureWeek = currentWeekStart > currentWeekMonday;
            
            document.getElementById('weekDisplay').textContent = `${startStr} - ${endStr}`;
            
            const statusElement = document.getElementById('weekStatus');
            if (isCurrentWeek) {
                statusElement.textContent = 'Agendamentos disponíveis para esta semana';
                statusElement.className = 'text-sm text-green-600 mt-1';
            } else if (isFutureWeek) {
                statusElement.textContent = 'Visualização apenas - agendamentos não disponíveis';
                statusElement.className = 'text-sm text-orange-600 mt-1';
            }
        }

        function updateDateButtons() {
            const container = document.getElementById('dateButtons');
            container.innerHTML = '';
            
            const days = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'];
            const today = new Date('2024-09-12');
            today.setHours(0, 0, 0, 0);
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(currentWeekStart);
                date.setDate(date.getDate() + i);
                
                const dateOnly = new Date(date);
                dateOnly.setHours(0, 0, 0, 0);
                const isPastDate = dateOnly < today;
                const isSelected = date.toDateString() === selectedDate.toDateString();
                
                const button = document.createElement('button');
                button.className = `p-3 rounded-lg text-center transition-colors ${
                    isSelected 
                        ? 'bg-green-500 text-white' 
                        : isPastDate 
                        ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                        : 'bg-gray-100 hover:bg-gray-200 text-gray-700'
                }`;
                button.innerHTML = `
                    <div class="font-bold">${days[i]}</div>
                    <div class="text-sm">${date.getDate().toString().padStart(2, '0')}</div>
                    ${isPastDate ? '<div class="text-xs mt-1">Passado</div>' : ''}
                `;
                
                if (!isPastDate) {
                    button.onclick = () => selectDate(date);
                }
                
                container.appendChild(button);
            }
        }

        function selectDate(date) {
            selectedDate = new Date(date);
            updateDateButtons();
            updateScheduleGrid();
        }

        function updateScheduleGrid() {
            const container = document.getElementById('scheduleGrid');
            container.innerHTML = '';
            
            // Recarregar bookings do localStorage
            bookings = JSON.parse(localStorage.getItem('tennisBookings') || '[]');
            
            const dateStr = selectedDate.toDateString();
            document.getElementById('selectedDateDisplay').textContent = 
                selectedDate.toLocaleDateString('pt-BR', { weekday: 'long', day: '2-digit', month: '2-digit', year: 'numeric' });

            // Verificar se é a semana atual - usando 12/09/2024 como referência
            const today = new Date('2024-09-12');
            const currentWeekMonday = new Date(today);
            currentWeekMonday.setDate(today.getDate() - today.getDay() + 1);
            const isCurrentWeek = currentWeekStart.getTime() === currentWeekMonday.getTime();

            // Check if selected date is in the past
            today.setHours(0, 0, 0, 0);
            const selectedDateOnly = new Date(selectedDate);
            selectedDateOnly.setHours(0, 0, 0, 0);
            const isPastDate = selectedDateOnly < today;

            // Generate time slots from 8:00 to 22:00
            for (let hour = 8; hour < 22; hour++) {
                const timeStr = `${hour.toString().padStart(2, '0')}:00`;
                const bookingKey = `${dateStr}-${timeStr}`;
                
                console.log('Verificando slot:', bookingKey);
                
                const existingBooking = bookings.find(b => b.key === bookingKey);
                const isMyBooking = existingBooking && existingBooking.userId === currentUser.id;
                const isBooked = existingBooking && !isMyBooking;
                
                // Verificar se é horário passado no dia atual
                let isPastHour = false;
                if (selectedDateOnly.getTime() === today.getTime()) {
                    // Para o dia 12/09, liberar todos os horários a partir das 8h
                    isPastHour = false;
                }
                
                // Só permitir agendamento na semana atual
                const canBook = isCurrentWeek && !isBooked && !isMyBooking && !isPastDate && !isPastHour;
                
                const slot = document.createElement('div');
                
                let slotClass, slotText;
                if (isMyBooking) {
                    slotClass = 'my-booking';
                    slotText = 'Meu Agendamento';
                } else if (isBooked) {
                    slotClass = 'booked cursor-not-allowed';
                    slotText = 'Ocupado';
                } else if (!isCurrentWeek) {
                    slotClass = 'bg-gray-400 cursor-not-allowed';
                    slotText = 'Visualização';
                } else if (isPastDate) {
                    slotClass = 'bg-gray-500 cursor-not-allowed';
                    slotText = 'Data Passada';
                } else if (isPastHour) {
                    slotClass = 'bg-gray-500 cursor-not-allowed';
                    slotText = 'Horário Passado';
                } else if (canBook) {
                    slotClass = 'available';
                    slotText = 'Disponível';
                } else {
                    slotClass = 'bg-gray-400 cursor-not-allowed';
                    slotText = 'Indisponível';
                }
                
                // Adicionar tooltip para slots ocupados
                let tooltipClass = '';
                let tooltipContent = '';
                if (isBooked || isMyBooking) {
                    tooltipClass = ' tooltip';
                    
                    // Mostrar nome para todos os usuários
                    const bookingUser = existingBooking ? existingBooking.userName : 'Usuário';
                    if (isMyBooking) {
                        tooltipContent = `<span class="tooltiptext">Seu agendamento<br>Data: ${existingBooking ? existingBooking.date : ''}<br>Horário: ${timeStr}</span>`;
                    } else {
                        tooltipContent = `<span class="tooltiptext">Reservado por: ${bookingUser}<br>Data: ${existingBooking ? existingBooking.date : ''}<br>Horário: ${timeStr}</span>`;
                    }
                }
                
                slot.className = `time-slot p-4 rounded-lg text-center font-semibold text-white cursor-pointer ${slotClass}${tooltipClass}`;
                
                slot.innerHTML = `
                    <div class="text-lg">${timeStr}</div>
                    <div class="text-sm mt-1">${slotText}</div>
                    ${tooltipContent}
                `;
                
                if (canBook) {
                    slot.setAttribute('data-booking-key', bookingKey);
                    slot.setAttribute('data-time', timeStr);
                    slot.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const key = this.getAttribute('data-booking-key');
                        const time = this.getAttribute('data-time');
                        console.log('Clicou no slot:', key, time);
                        bookSlot(key, time);
                    };
                } else if (isMyBooking && isCurrentWeek) {
                    slot.setAttribute('data-booking-key', bookingKey);
                    slot.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const key = this.getAttribute('data-booking-key');
                        console.log('Clicou para cancelar:', key);
                        cancelBooking(key);
                    };
                }
                
                container.appendChild(slot);
            }
        }

        function bookSlot(bookingKey, timeStr) {
            console.log('Função bookSlot chamada:', bookingKey, timeStr);
            
            if (confirm(`Confirmar agendamento para ${timeStr} no dia ${selectedDate.toLocaleDateString('pt-BR')}?`)) {
                // Recarregar bookings antes de adicionar novo
                bookings = JSON.parse(localStorage.getItem('tennisBookings') || '[]');
                
                const booking = {
                    key: bookingKey,
                    userId: currentUser.id,
                    userName: currentUser.name,
                    date: selectedDate.toLocaleDateString('pt-BR'),
                    time: timeStr,
                    timestamp: Date.now()
                };
                
                console.log('Criando agendamento:', booking);
                
                bookings.push(booking);
                localStorage.setItem('tennisBookings', JSON.stringify(bookings));
                
                console.log('Agendamento salvo. Total de agendamentos:', bookings.length);
                
                updateScheduleGrid();
                updateMyBookings();
                alert('Agendamento realizado com sucesso!');
            }
        }

        function cancelBooking(bookingKey) {
            console.log('Função cancelBooking chamada:', bookingKey);
            
            if (confirm('Deseja cancelar este agendamento?')) {
                // Recarregar bookings antes de filtrar
                bookings = JSON.parse(localStorage.getItem('tennisBookings') || '[]');
                
                console.log('Bookings antes do cancelamento:', bookings.length);
                
                bookings = bookings.filter(b => b.key !== bookingKey);
                localStorage.setItem('tennisBookings', JSON.stringify(bookings));
                
                console.log('Bookings após cancelamento:', bookings.length);
                
                updateScheduleGrid();
                updateMyBookings();
                alert('Agendamento cancelado com sucesso!');
            }
        }

        function updateMyBookings() {
            const container = document.getElementById('myBookings');
            
            // Se for administrador, mostrar todos os agendamentos
            if (currentUser && currentUser.isAdmin) {
                const allBookings = bookings.sort((a, b) => a.timestamp - b.timestamp);
                
                // Atualizar título da seção
                const sectionTitle = document.querySelector('#mainApp .bg-white:last-child h3');
                sectionTitle.textContent = 'Todos os Agendamentos (Admin)';
                
                if (allBookings.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-center py-4">Não há agendamentos no sistema.</p>';
                    return;
                }
                
                container.innerHTML = allBookings.map(booking => `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                        <div>
                            <div class="font-semibold text-gray-800">${booking.date} às ${booking.time}</div>
                            <div class="text-sm text-gray-600">Quadra de Tênis - ${booking.userName}</div>
                        </div>
                        <button onclick="cancelBooking('${booking.key}')" 
                                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                            Cancelar
                        </button>
                    </div>
                `).join('');
            } else {
                // Para usuários normais, mostrar apenas seus agendamentos
                const userBookings = bookings
                    .filter(b => b.userId === currentUser.id)
                    .sort((a, b) => a.timestamp - b.timestamp);
                
                // Atualizar título da seção
                const sectionTitle = document.querySelector('#mainApp .bg-white:last-child h3');
                sectionTitle.textContent = 'Meus Agendamentos';
                
                if (userBookings.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-center py-4">Você não possui agendamentos.</p>';
                    return;
                }
                
                container.innerHTML = userBookings.map(booking => `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                        <div>
                            <div class="font-semibold text-gray-800">${booking.date} às ${booking.time}</div>
                            <div class="text-sm text-gray-600">Quadra de Tênis</div>
                        </div>
                        <button onclick="cancelBooking('${booking.key}')" 
                                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                            Cancelar
                        </button>
                    </div>
                `).join('');
            }
        }

        function exportToCSV() {
            // Verificar se é administrador
            if (!currentUser || !currentUser.isAdmin) {
                alert('Acesso negado. Apenas administradores podem exportar dados.');
                return;
            }
            
            // Recarregar bookings do localStorage
            const allBookings = JSON.parse(localStorage.getItem('tennisBookings') || '[]');
            
            // Para administrador, exportar TODOS os agendamentos
            const bookingsToExport = allBookings.sort((a, b) => a.timestamp - b.timestamp);
            
            if (bookingsToExport.length === 0) {
                alert('Não há agendamentos para exportar.');
                return;
            }
            
            // Criar cabeçalho CSV
            const csvHeader = 'Data,Horário,Local,Nome do Usuário\n';
            
            // Criar linhas CSV
            const csvRows = bookingsToExport.map(booking => {
                return `"${booking.date}","${booking.time}","Quadra de Tênis","${booking.userName}"`;
            }).join('\n');
            
            // Combinar cabeçalho e dados
            const csvContent = csvHeader + csvRows;
            
            // Criar e baixar arquivo
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `todos_agendamentos_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                alert('Arquivo CSV com todos os agendamentos exportado com sucesso!');
            } else {
                alert('Seu navegador não suporta download de arquivos.');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in
            const savedUser = localStorage.getItem('currentTennisUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('authContainer').classList.add('hidden');
                document.getElementById('userInfo').classList.remove('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                initializeApp();
            }
        });

        // Save current user on login - removed duplicate function

        // Clear saved user on logout - removed duplicate function
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97e1743a973dca76',t:'MTc1NzcwMTU5NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
